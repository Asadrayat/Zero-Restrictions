
{% liquid
  assign id = section.id
%}
{%- assign metafield_title_list = product.metafields.custom.product_attribute_list.value -%}
{% unless metafield_title_list == blank %}
  
<style>
  #shopify-section-{{id}} {
    box-sizing: border-box;
    margin-top: {{section.settings.margin_top | append: 'px'}};
    margin-bottom: {{section.settings.margin_bottom | append: 'px'}};
    padding-top: {{section.settings.padding_top | append: 'px'}};
    padding-bottom: {{section.settings.padding_bottom | append: 'px'}};
    background-color: #F3F4F6;
  }
  #shopify-section-{{id}} .swiper-wrapper {
    transition-timing-function: linear !important;
  }
  .swiper-wrapper.justify-center .fabric__item  {
    margin: auto;
  }

  @media(max-width: 1023px) {
    #shopify-section-{{id}} .swiper-slide {
      width: auto !important;
    }
  }
  @media(max-width: 768px) {
    #shopify-section-{{id}} {
      margin-top: {{section.settings.margin_top_m | append: 'px'}};
      margin-bottom: {{section.settings.margin_bottom_m | append: 'px'}};
      padding-top: {{section.settings.padding_top_m | append: 'px'}};
      padding-bottom: {{section.settings.padding_bottom_m | append: 'px'}};
    }
  }
  .wrapper-{{ id }}:not(.swiper) .swiper-wrapper {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 80px;
  }

  .fabric__items{
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 80px;
    overflow-x: auto;
    scrollbar-width: none;
    max-width: 100%;
    margin: auto;
  }
  .fabric__item{
    display: flex;
    align-items: center;
    gap: 24px;
    width: max-content;
  }
  .fabric__item img{
    display: block;
    width: 40px;
    height: 40px;
    aspect-ratio: 1/1;
  }
  .fabric__item span, .fabric__item p{
    font-size: 20px;
    line-height: 24px;
    color: #10100f;
    margin: 0;
  }

  @media screen and (max-width: 768px){
    .fabric__items{
      justify-content: space-between;
      gap: 16px;
    }
    .fabric__item{
      flex: 1;
      min-width: max-content;
      gap: 8px;
    }
    .fabric__item img{
      width: 24px;
      height: 24px;
    }
    .fabric__item span{
      font-size: 18px;
      line-height: 22px;
    }
  }
</style>



{% # if product.metafields.custom.fabric_features.value != blank %}
<div class="sec-{{ id }}">
  <div class="{% unless section.settings.full_width %}page-width{% endunless %}">
    <div class="wrapper-{{ id }} swiper fabric__items">
      <div class="swiper-wrapper cai__pa__child_content">
        {% comment %}
          {% for x in shop.metaobjects.fabric_features.values %}
            {% assign meta_obj_title = x.title | handleize %}
            {% assign metafield_title = product.metafields.custom.product_attribute_list.value | handleize %}
            {% if metafield_title contains meta_obj_title %}
              <div class="swiper-slide">
                <div class="fabric__item">
                  {{ x.icon | image_url: width: 50 | image_tag: class: 'warranty-icon' }}
                  <span>{{ x.title }}</span>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        {% endcomment %}
      </div>
    </div>
  </div>
</div>
{% # endif %}

<script>
  window.iconTextFunc = function () {
    // Fabric Feature Group 1
    const features1 = [
      {% for feature in shop.metaobjects.fabric_features.values %}
        {
          title: {{ feature.title | json }},
          icon: {{ feature.icon | image_url: width: 64 | json }}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ];

    // Fabric Feature Group 2
    const features2 = [
      {% for feature in shop.metaobjects.fabric_features_2.values %}
        {
          title: {{ feature.title | json }},
          icon: {{ feature.icon | image_url: width: 64 | json }}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ];

    const metafieldTitles = {{ metafield_title_list | json }};
    const containerIconText = document.querySelector(".cai__pa__child_content");

    if (!containerIconText || !Array.isArray(metafieldTitles)) {
      console.warn("Missing container or metafield data");
      return;
    }

    containerIconText.innerHTML = ""; // Clear previous content if re-rendering
    const mergedFeatures = [...features1, ...features2];

    function toHandle(str) {
      return str
        .toLowerCase()
        .replace(/['"]/g, "")
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "");
    }

    mergedFeatures.forEach((feature) => {
      const featureHandle = toHandle(feature.title);

      metafieldTitles.forEach((title) => {
        const titleHandle = toHandle(title);

        if (featureHandle === titleHandle) {
          const html = `
            <div class="swiper-slide">
              <div class="fabric__item">
                <span class="icon">
                  <img src="${feature.icon}" width="24" height="24" alt="${feature.title}" loading="lazy" />
                </span>
                <p>${feature.title}</p>
              </div>
            </div>
          `;
          containerIconText.insertAdjacentHTML("beforeend", html);
        }
      });
    });

    // After content is added, call Swiper init
    window.iconTextSwiperFunc(); // <- call this after slide insertion
  };

  window.iconTextSwiperFunc = function () {
    const swiperContainer = document.querySelector(".wrapper-{{ id }}.swiper");

    if (!swiperContainer) return;

    const slideCount = swiperContainer.querySelectorAll(".swiper-slide").length || 0;

    if (slideCount === 0) return;

    const wrapper = swiperContainer.querySelector(".swiper-wrapper");
    if (slideCount < 4 && wrapper) {
      wrapper.classList.add("justify-center");
    }

    new Swiper(swiperContainer, {
      slidesPerView: 'auto',
      spaceBetween: 16,
      speed: 5000,
      loop: slideCount > 4,
      autoplay: {
        delay: 0,
        disableOnInteraction: false,
      },
      breakpoints: {
        768: {
          slidesPerView: 'auto',
          spaceBetween: 16,
        },
        1024: {
          slidesPerView: 4,
          spaceBetween: 80,
        },
        1400: {
          slidesPerView: slideCount > 4 ? 5 : 4,
          spaceBetween: 80,
        },
        2000: {
          slidesPerView: slideCount > 4 ? 6 : 4,
          spaceBetween: 80,
        },
      },
    });
  };

  // Run when DOM is ready
  document.addEventListener("DOMContentLoaded", () => {
    window.iconTextFunc();
  });
</script>
{% endunless %}


{% schema %}
{
  "name": "Fabric Features",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full Width Section",
      "default": true
    },
    {
      "type": "header",
      "content": "Section Spacing Desktop"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 24
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 0
    },
    {
      "type": "header",
      "content": "Section Spacing Mobile"
    },
    {
      "type": "range",
      "id": "margin_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Top",
      "default": 24
    },
    {
      "type": "range",
      "id": "margin_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_top_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom_m",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Fabric Features"
    }
  ]
}
{% endschema %}
