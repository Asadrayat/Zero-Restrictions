{{ 'size-guide-new.css' | asset_url | stylesheet_tag }}
<style>
      .size__popup {
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }

    .size__popup-content {
      background: white;
      padding: 16px;
      border-radius: 10px;
      max-width: 1000px;
      width: 90%;
      max-height: 90vh;
      position: relative;
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
      transform: scale(0.8);
      transition: transform 0.3s ease-in-out;
      overflow-y: auto;
      scrollbar-color: #1F2937 #f1f1f1;
      scrollbar-width: thin;
    }

    .size__popup.show {
      opacity: 1;
      visibility: visible;
    }

    .size__popup.show .size__popup-content {
      transform: scale(1);
    }
    .size__popup-header{
      display: flex;
      align-items: center;
      gap: 32px;
      padding: 0 0 6px;
      border-bottom: 1px solid var(--Border-Base-main, #D1D5DB);
      justify-content: space-between;
    }
    .header__contents h4{
      color: #000;
      font-family: var(--font-family-Title)
      font-size: var(--Font-Size-Heading-H3);
      line-height: var(--Line-Height-Heading-H3); /* 116.667% */
      letter-spacing: -0.48px;
      margin: 0 0  var(--Spacing-Container-xxs);
    }
    .header__contents p{
      color: #000;
      font-family: var(--font-family-Body);
      font-size: 16px;
      line-height: 20px; /* 125% */
      margin: 0;
    }
    #closePopup {
      background: none;
      border: none;
      outline: none;
      cursor: pointer;
    }

    .size__popup.hide {
      opacity: 0;
      visibility: hidden;
    }

    .size__popup.hide .size__popup-content {
      transform: scale(0.8);
    }

  .size__popup-content{
  .pt__richtext.active{
  display: block;
  }
  .pt__richtext{
  display: none;
  }
  .category__wrap {
      display: flex;
      gap: 16px;
      padding-block: 16px;
  }
  .category__heading .button{
    margin: 0;
  }
  .category__heading.active .button{
      background: #000;
      color: #FFF;
  }
  .--single-chart{
  padding-block: 16px !important;
  }
    .--sub-tab--title{
      color: #000;
      {% comment %} margin: 0 0 var(--Spacing-Container-sm, 16px); {% endcomment %}
      font-family: var(--font-family-Title, Archivo);
      {% comment %} font-size: var(--Font-Size-Heading-H2, 40px); {% endcomment %}
      font-style: normal;
      font-weight: 500;
      {% comment %} line-height: var(--Line-Height-Heading-H2, 40px); /* 100% */ {% endcomment %}
      letter-spacing: -0.4px;
      text-transform: capitalize;
      font-size: 28px;
      line-height: 28px;
      margin: 16px 0;
      @media(max-width: 768px){
       font-size: 18px;
      line-height: 18px;
      }
    }
  }
</style>

{% assign size_charts_type = product.metafields.custom.shop_for.value %}

<div id="size__popup" class="size__popup">
  <div class="size__popup-content">
    <div class="size__popup-header">
      <div class="header__contents">
        <h4>Size Guide</h4>
        {% comment %}
          <p>Baruffa Merino Quarter Zip Wind Sweater</p>
        {% endcomment %}
      </div>
      <button id="closePopup" class="closePopup close">{% render 'all-icons', name: 'close' %}</button>
    </div>

    <div class="category__wrap">
      <div
        class="category__heading active category__heading-size--chart"
        data-title="size--chart"
      >
        <h3 class="--secondary-button-style button">Size Chart</h3>
      </div>
      <div
        class="category__heading category__heading-size--content"
        data-title="size--content"
      >
        <h3 class="--secondary-button-style button">How to measure</h3>
      </div>
    </div>
    <div class="content__wrap">
      <div
        class="pt__richtext active"
        data-title="size--chart"
      >
        <div class="sizecharts">
          {% if size_charts_type %}
            {% for size_chart_type in size_charts_type %}
              {% assign type = size_chart_type | downcase %}
              {% comment %} {{ type }} {% endcomment %}
              {% if type == 'men' %}
                <p class="--sub-tab--title">Men’s Tops Body Measurement</p>
                {% render 'size-chart-men-top' %}
              {% endif %}
              {% if type == 'men' %}
                <p class="--sub-tab--title">Men’s Bottoms Body Measurement</p>
                {% render 'size-chart-men-bottom' %}
              {% endif %}
              {% if type == 'women' %}
                <p class="--sub-tab--title">Women’s Tops Body Measurement</p>
                {% render 'size-chart-women-top' %}
              {% endif %}
              {% if type == 'women' %}
                <p class="--sub-tab--title">Women’s Bottoms Body Measurement</p>
                {% render 'size-chart-women-bottom' %}
              {% endif %}
            {% endfor %}
        {% else %}
          <p class="--sub-tab--title">Men’s Tops Body Measurement</p>
          {% render 'size-chart-men-top' %}
          <p class="--sub-tab--title">Men’s Bottoms Body Measurement</p>
          {% render 'size-chart-men-bottom' %}
          <p class="--sub-tab--title">Women’s Tops Body Measurement</p>
          {% render 'size-chart-women-top' %}
          <p class="--sub-tab--title">Women’s Tops Body Measurement</p>
          {% render 'size-chart-women-top' %}
        {% endif %}
          {% comment %} {% render 'size-chart-contents' %} {% endcomment %}
        </div>
      </div>
      <div
        class="pt__richtext"
        data-title="size--content"
      >
        {% if size_charts_type %}
          {% for size_chart_type in size_charts_type %}
            {% assign type = size_chart_type | downcase %}
            {% comment %} {{ type }} {% endcomment %}
            {% if type == 'men' %}
              {% render 'size-popup-content-data', type: type %}
            {% elsif type == 'women' %}
              {% render 'size-popup-content-data', type: type %}
            {% endif %}
          {% endfor %}
        {% else %}
              {% render 'size-popup-content-data', type: type %}
        {% endif %}
      </div>
    </div>

    {% comment %}
      <div class="sizecharts">
        {% render 'size-chart-contents' %}
      </div>
    {% endcomment %}
  </div>
</div>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    window.sizeGuide();

    // Tab functionality
    const tabHeadings = document.querySelectorAll('.category__heading');
    const contents = document.querySelectorAll('.pt__richtext');

    if (tabHeadings.length && contents.length) {
      tabHeadings[0].classList.add('active');
      contents[0].classList.add('active');
    }

    tabHeadings.forEach((tabHeading) => {
      tabHeading.addEventListener('click', () => {
        tabHeadings.forEach((th) => th.classList.remove('active'));
        contents.forEach((content) => content.classList.remove('active'));

        tabHeading.classList.add('active');
        contents.forEach((content) => {
          if (content.dataset.title === tabHeading.dataset.title) {
            content.classList.add('active');
          }
        });
      });
    });

    // Handle size chart toggles (if needed)
    let charts = document.querySelectorAll('.--single-chart');

    charts.forEach((chart) => {
      let toggleButton = chart.querySelector('.--toggle');

      if (toggleButton) {
        toggleButton.addEventListener('change', () => {
          let toUnit = toggleButton.checked ? 'cm' : 'in';
          convertMeasurements(chart, toUnit);
        });
      }
    });

    function convertMeasurements(chart, toUnit) {
      let rows = chart.querySelectorAll('.--measurement-row.--only-values');

      rows.forEach((row) => {
        let waistCell = row.children[1];
        let chestCell = row.children[2];
        let neckCell = row.children[3];
        let sleeveCell = row.children[4];
        waistCell.textContent = convertUnits(parseFloat(waistCell.textContent), toUnit);
        chestCell.textContent = convertUnits(parseFloat(chestCell.textContent), toUnit);
        neckCell.textContent = convertUnits(parseFloat(neckCell.textContent), toUnit);
        sleeveCell.textContent = convertUnits(parseFloat(sleeveCell.textContent), toUnit);
      });
    }

    function convertUnits(value, toUnit) {
      if (isNaN(value)) return 'N/A';
      return toUnit === 'cm' ? (value * 2.54).toFixed(2) : (value / 2.54).toFixed(0);
    }
  });

  window.sizeGuide = function () {
    const popup = document.querySelector('.size__popup'); // Single popup
    const openPopupBtns = document.querySelectorAll('.openPopup'); // Multiple open buttons
    const closePopupBtn = document.querySelector('.closePopup'); // Single close button

    // Attach event listeners to all open buttons
    openPopupBtns.forEach((openPopupBtn) => {
      openPopupBtn.addEventListener('click', function () {
        popup.classList.add('show');
        popup.classList.remove('hide');
      });
    });

    // Attach event listener to the close button
    closePopupBtn.addEventListener('click', () => closePopup(popup));

    // Attach event listener to the popup for closing on outside click
    popup.addEventListener('click', function (event) {
      if (event.target === popup) {
        closePopup(popup);
      }
    });

    // Function to close the popup
    function closePopup(popup) {
      popup.classList.add('hide');
      setTimeout(() => {
        popup.classList.remove('show');
      }, 300);
    }
  };
</script>
